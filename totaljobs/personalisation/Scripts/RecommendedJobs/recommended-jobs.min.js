var TotalJobsGroup = TotalJobsGroup || {};
TotalJobsGroup.Personalisation = TotalJobsGroup.Personalisation || {}, TotalJobsGroup.Personalisation.RecommendedJobs = TotalJobsGroup.Personalisation.RecommendedJobs || {}, TotalJobsGroup.Personalisation.RecommendedJobs.DataService = function(e) {
    "use strict";

    function t(e, t, o, a) {
        return null === e || "undefined" == typeof e || "" === e ? n(analytics.RecommendedJobsOrigin, t, o, a) : n(e, t, o, a)
    }

    function n(t, n, o, i) {
        return e.ajax({
            type: "GET",
            data: {
                origin: t,
                halo: n,
                lastAppliedJobId: o,
                additionalAppliedJobIds: i
            },
            url: a.getRecommendationsServiceUrl,
            contentType: "text/html; charset=utf-8",
            timeout: a.timeout
        })
    }

    function o(t) {
        return e.ajax({
            type: "POST",
            url: a.discardJobServiceUrl,
            data: {
                jobId: t
            },
            timeout: a.timeout
        })
    }
    var a = {
        getRecommendationsServiceUrl: "/Personalisation/RecommendedJobs",
        discardJobServiceUrl: "/Personalisation/RecommendedJobs/Dismiss",
        timeout: "10000"
    };
    return {
        getRecommendations: t,
        discardJob: o
    }
}(jQuery), TotalJobsGroup.Personalisation.RecommendedJobs.Helpers = function() {
    "use strict";

    function e(e, t) {
        var n = e.closest(".rj-results-container");
        void 0 !== t && t.length > 0 ? n.hasClass("hidden") && n.removeClass("hidden") : n.hasClass("hidden") || n.addClass("hidden")
    }

    function t(e) {
        "undefined" != typeof console && "undefined" != typeof console.log && console.log(e)
    }

    function n() {
        return window.TransitionEvent
    }
    return {
        showRecommendedJobsSectionIfWeHaveData: e,
        log: t,
        isCssAnimationSupported: n
    }
}(), TotalJobsGroup.Personalisation.RecommendedJobs = function(e, t, n) {
    "use strict";

    function o() {
        e(".rj-jobs-list").children("." + P).first().addClass(C).removeClass(P)
    }

    function a(e) {
        return {
            jobId: e.attr("data-job-id"),
            dataRank: e.attr("data-rank")
        }
    }

    function i() {
        return A
    }

    function r(e) {
        "complete" === document.readyState ? e() : window.addEventListener("load", function(t) {
            e()
        })
    }

    function d(t) {
        var a = e("#" + t.jobId),
            i = a.index();
        n.isCssAnimationSupported() ? (V || e(".rj-jobs-list>div:eq(" + i + ")").addClass("animated bounceOutLeft"), x ? window.innerWidth >= 460 && (i > 2 ? e(".rj-jobs-list>div:gt(" + i + ")").addClass("animated moveLeft") : e(".rj-jobs-list>div:gt(" + i + "):lt(" + (2 - i) + ")").addClass("animated moveLeft")) : S() || V || e(".rj-jobs-list>div:gt(" + i + ")").addClass("animated moveLeft"), V || setTimeout(function() {
            e(".rj-jobs-list>div:gt(" + i + ")").removeClass("animated moveLeft"), o(), a.remove()
        }, 750)) : (o(), a.remove())
    }

    function l(n) {
        n.preventDefault(), e(this).addClass("skipped"), M++, A--;
        var o = a(e(this));
        b(), d(o), t.discardJob(o.jobId, o.dataRank).fail()
    }

    function c(t) {
        M++, A--;
        var n = e(t)[0],
            o = {
                jobId: n.id,
                dataRank: 0
            };
        b(), d(o)
    }

    function u() {
        e(G).one("click", ".left-box button", l)
    }

    function b() {
        1 === A ? e(".rj-list-title").html('<span class="hidden-sm hidden-md hidden-lg">1</span> Recommended job') : e(".rj-list-title").html('<span class="hidden-sm hidden-md hidden-lg">' + A + "</span> Recommended jobs")
    }

    function m() {
        window.SavedJobsManager = window.SavedJobsManager || SavedJobs.Manager(e);
        var t;
        t = window.TotalJobsGroup.IsSaonBrands ? SavedJobs.Events(e, window.SavedJobsManager, !0) : SavedJobs.Events(e, window.SavedJobsManager), e('div[id^="rj-results"]').on("update", ".btn-savejob", function(t, n) {
            void 0 !== n && n.isInitialUpdate === !0 || e(this).hasClass("saved") && (0 == e(this).hasClass("omj-donthide") && c(this), 0 == this.classList.contains("omj-suppress-e901") && T())
        }), t.bindEvents(), t.triggerEvents({
            isInitialUpdate: !0
        });
        var n = window.Toast;
        n.bindEvents()
    }

    function p() {
        var e = "event901,event16",
            t = s_gi(analLib.getSiteId());
        t.linkTrackVars = "eVar23,eVar30,events", t.linkTrackEvents = e, t.events = e, t.tl(analLib, "o", "Recommended Job Saved")
    }

    function v(t) {
        var n = e(t),
            o = "false";
        n.data("external") && (o = n.data("external").toLowerCase());
        var a = s_gi(analLib.getSiteId());
        a.linkTrackVars = "eVar7,eVar8,eVar23,eVar30,eVar190,eVar223,events";
        var i = "event14,event28,event35";
        a.eVar7 = "First Party", "true" === o && (i = "event14, event28", a.eVar7 = "Third Party");
        var r = n.data("fromMya");
        n.removeData("fromMya"), n.removeAttr("fromMya");
        var s = "One More Job Applied",
            d = "|1|One More Job|",
            l = "Top_Button";
        void 0 !== r && (d = "|1|Mya|", l = "Mya_Button", s = "Mya " + s), a.eVar8 = d, a.eVar190 = l, a.linkTrackEvents = i, a.events = i, a.tl(analLib, "o", s)
    }

    function f() {
        var e = "event950",
            t = s_gi(analLib.getSiteId());
        t.linkTrackVars = "eVar23,eVar30,events", t.linkTrackEvents = e, t.events = e, t.tl(analLib, "o", "Recommended Job Discarded")
    }

    function y() {
        var e = "event19",
            t = s_gi(analLib.getSiteId());
        t.linkTrackVars = "eVar23,eVar30,events", t.linkTrackEvents = e, t.events = e, t.tl(analLib, "o", "Recommender_QuickView")
    }

    function h(t, n, o) {
        var a = e(t),
            i = a.data("external"),
            r = i === !0 ? "event28" : "event28,event35",
            s = s_gi(analLib.getSiteId());
        s.linkTrackVars = "eVar23,eVar30,events", s.linkTrackEvents = r, s.events = r, s.tl(analLib, "o", o), n && (a.css("pointer-events", "none"), a.text("Applied"))
    }

    function J() {
        var e = s_gi(analLib.getSiteId());
        e.linkTrackVars = "eVar23", e.tl(analLib, "0", "Recommended Job - Company Search Click"), e.props = ""
    }

    function g(o, a, i, d, l) {
        t.getRecommendations(a, i, d, l).success(function(t, a, i) {
            if (200 === i.status) try {
                var d = e(t),
                    l = 3;
                (x || V) && (l = 6), d.find(G).slice(0, l).addClass(C).removeClass(P), o.html(d), A = e(E).length - 1, b(), u(), m(), void 0 === s.eVar23 && (s.eVar23 = s.pageName), e("input.btn-send-application").each(function() {
                    e(this).on("click", function() {
                        h(this, !0, "Click on Apply")
                    })
                }), e("a.rj-edit-app").each(function() {
                    var t = e(this).hasClass("rj-quickview-apply") ? "Click on Apply - Confirmation Recommender QuickView" : "Click on Apply";
                    e(this).on("click", function() {
                        h(this, !1, t)
                    })
                }), e(".rj-secondary-actions .btn-savejob").each(function() {
                    1 !== e(this).parents("div .searchresults-jobbar-recommenderjobs").length && 1 !== e(this).parents("div #details-recommender").length && e(this).on("click", function() {
                        p()
                    })
                }), e(".company-link").each(function() {
                    e(this).on("click", function() {
                        J()
                    })
                }), e(".rj-skip-btn").each(function() {
                    e(this).on("click", function() {
                        f()
                    })
                }), e(".rj-quick-view-link").each(function() {
                    e(this).on("click", function() {
                        y()
                    })
                }), e(".omj-apply-btn").each(function() {
                    e(this).on("click", function() {
                        v(this)
                    })
                })
            } finally {
                r(S() ? function() {
                    analLib.fireRecomendedJobsEvents("event74", "Recommended Jobs Served - Search Results Bottom", j())
                } : w() ? function() {
                    analLib.fireRecomendedJobsEvents("event74", "Recommended Jobs Served - Job Details Similar To Search", j())
                } : function() {
                    analLib.fireRecomendedJobsEvents("event74", "Recommended Jobs Served", j())
                }), o.trigger("recommender-rendered")
            } else 204 === i.status ? n.log("No jobs found") : n.log("An error occurred :o| [" + a + "]")
        }).fail(function(e) {
            n.log("An error occurred :o( [" + e.status + "]")
        })
    }

    function j() {
        var t = e(".rj-row-holder:visible"),
            n = t.length,
            o = t.find(".rj-hero:not(.watermark)").length;
        return n === o ? "All" : 0 === o ? "None" : o
    }

    function T() {
        var e = window.SavedJobsManager;
        e && e.trackOnSitecatalyst("event901", "Recommended Job Saved")
    }

    function S() {
        var t, n, o = e(".rj-results-container")[0];
        return e.isNullOrUndefined(o) || e.isNullOrUndefined(o.dataset) || (t = o.dataset, n = t.issearchrecommender), !e.isNullOrUndefined(n) && "True" === n
    }

    function w() {
        return "JobDetailsPageSimilarToSearch" === e("#details-recommender").data("origin")
    }

    function k() {
        var e = document.querySelector(".btn .btn-exlg .btn-primary .brand-font .apply-now-btn, .disabled"),
            t = document.querySelector("#mya-harmonised-button-panel  [data-testid='harmonised-apply-button']:disabled"),
            n = void 0 !== e && null !== e && void 0 !== e.attributes.disabled,
            o = void 0 !== t && null !== t && void 0 !== t.attributes.disabled,
            a = window.myaPostApplySegment || [];
        return n === !1 && o === !1 && 0 !== a.length && a.tests.myaChat.display === !0
    }

    function R() {
        var t = e("#recommended-jobs-placeholder");
        t.on("recommender-rendered", function() {
            var t = +e("#omj-job-id").data("job-id");
            if (isNaN(t) === !1) {
                var n = TotalJobsGroup.MyaEventsSubscription(t);
                TotalJobsGroup.ButtonManager(t, TotalJobsGroup.ButtonService, e(document.documentElement), v);
                var o = e("#mya-placeholder");
                o.on("apply-button-ready", function() {
                    var t = e("#omj-meta-data");
                    k() && TotalJobsGroup.Personalisation.RecommendedJobs.OneMoreJob.MyaConversation(t.data("job-id"), t.data("job-external"), n.sendApplication, n.editApplication)
                })
            }
        });
        var n = e("#details-recommender");
        return n.length ? void g(n, n.data("origin"), null, null, null) : void(t.length && g(t, t.data("origin"), t.data("halo"), t.data("lastappliedjobid"), t.data("additionalappliedjobids")))
    }
    var G = ".rj-row-holder",
        E = ".rj-job-container",
        C = "rj-visible-row",
        P = "rj-hidden-row",
        A = 0,
        M = 0,
        x = window.location.href.indexOf("/apply/confirmation") !== -1,
        V = window.location.href.indexOf("/job/") !== -1 && !x;
    return e(document).ready(R), {
        retrieveRecommendations: g,
        getNumberOfRecommendedJobs: i
    }
}(jQuery, TotalJobsGroup.Personalisation.RecommendedJobs.DataService, TotalJobsGroup.Personalisation.RecommendedJobs.Helpers);
var TotalJobsGroup = TotalJobsGroup || {};
TotalJobsGroup.Personalisation = TotalJobsGroup.Personalisation || {}, TotalJobsGroup.Personalisation.RecommendedJobs = TotalJobsGroup.Personalisation.RecommendedJobs || {}, TotalJobsGroup.Personalisation.RecommendedJobs.Logging = function(e) {
    var t = function(t, n, o) {
        200 === o.status && e.ajax({
            url: "/personalisation/recommenderdatalogger/logdata",
            data: JSON.stringify({
                search: t
            }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            type: "post",
            cache: !1
        })
    };
    this.log = function(n) {
        var o = "function" != typeof n ? n : n();
        if (o) {
            var a = JSON.stringify(o);
            e.ajax({
                url: "/personalisation/recommenderdatastamper/stamp",
                data: {
                    data: a
                },
                dataType: "json",
                type: "post"
            }).done(t)
        }
    }, this.logToPersonalisation = t
};
var TotalJobsGroup = TotalJobsGroup || {};
TotalJobsGroup.ButtonManager = function(e, t, n, o) {
    var a = function(e, t) {
            var o = $($(".buttons-panel", n)[e]);
            $(".default-panel", o).remove(), o.append(t)
        },
        i = function(e, t) {
            return a(e, t), a(++e, t), a(++e, t), $.Deferred().resolve()
        },
        r = function(e, t, n, o) {
            $(t, e).each(function(e) {
                $(this).css(n, o)
            })
        },
        s = function() {
            if ($("a.apply-btn,a.apply-now-btn,a.oca-btn", n).not(".apply-disabled").not(".disabled").each(function(e, t) {
                    var n = $(t);
                    "undefined" != typeof $.fn.on && $.isFunction($.fn.on) ? n.on("click", function() {
                        o(n)
                    }) : n.click(function() {
                        o(n)
                    });
                    var a = n.context.href;
                    if (void 0 !== a && "" !== a) {
                        var i = new URL(a);
                        n.context.href = i.toString()
                    }
                }), r(n, ".send-job-col", "display", "none"), r(n, ".save-job-col", "display", "none"), r(n, ".hidden", "display", "none"), r(n, ".oca-btn", "float", "right"), r(n, ".oca-edit-app", "float", "left"), r(n, ".oca-twin-mob", "display", "none"), !document.querySelector(".apply-button")) {
                var e = $("#mya-placeholder");
                e.trigger("apply-button-ready")
            }
        },
        d = function() {
            var n = t.getButtonMarkUpFromServer(0, e).then(i.bind(i, 0));
            return $.when(n).done(function() {
                s();
                const e = new Event("ApplyButtonsRender");
                document.body.dispatchEvent(e)
            }), $.when(n)
        };
    return d()
};
var TotalJobsGroup = TotalJobsGroup || {};
TotalJobsGroup.ButtonService = {
    getButtonMarkUpFromServer: function(e, t) {
        var n = {
            buttonpanelindex: e,
            jobDetailsPagePathAndQuery: "",
            TemplateType: analytics.TemplateType
        };
        return n.jobId = t, $.ajax({
            url: "/jsd/webmvc/PartialsPersonalisation/GetButtonsPanel?r=1-One More Job",
            data: n,
            type: "GET",
            cache: !1
        })
    }
};
var TotalJobsGroup = TotalJobsGroup || {};
TotalJobsGroup.Personalisation = TotalJobsGroup.Personalisation || {}, TotalJobsGroup.Personalisation.RecommendedJobs = TotalJobsGroup.Personalisation.RecommendedJobs || {}, TotalJobsGroup.Personalisation.RecommendedJobs.OneMoreJob = TotalJobsGroup.Personalisation.RecommendedJobs.OneMoreJob || {}, TotalJobsGroup.Personalisation.RecommendedJobs.OneMoreJob.MyaConversation = function(e, t, n, o) {
    "use strict";

    function a(e) {
        for (var t = Object.keys(e), n = t.length, o = new Array(n); n--;) o[n] = [t[n], e[t[n]]];
        return o
    }

    function i() {
        for (var e, t = window.location.host.includes("tjgdev") ? "myastaging" : "mya", n = {
                cwjobs: 2,
                totaljobs: 4,
                jobsite: 7,
                milkround: 9,
                catererglobal: 77,
                caterer: 10,
                cityjobs: 40,
                justengineers: 50,
                emedcareers: 60,
                retailchoice: 76,
                careerstructure: 80
            }, o = a(n), i = 0; i < o.length; i++) window.location.host.indexOf(o[i][0] + ".") !== -1 && (e = o[i]);
        if (!e) throw new Error("SiteId wasn't correctly determined.");
        return {
            theme: e[0],
            siteId: e[1],
            tenant: t
        }
    }

    function r() {
        return {
            site_id: c.siteId,
            job: {
                application_type: d(),
                cta_send_application: n,
                cta_edit_application: o,
                job_id: e,
                title: l("omj-rj-jobtitle"),
                location: l("location rj-omj-icon"),
                salary: l("salary rj-omj-icon"),
                contract_type: l("type-icon rj-omj-icon"),
                employer: l("company-link"),
                posting_label: l("posted-icon rj-omj-icon")
            }
        }
    }

    function s(e) {
        return {
            iconPositionY: e
        }
    }

    function d() {
        var e = document.querySelector("a[title='Send application']");
        if (null !== e) return "OCA";
        var n = document.querySelector(".btn .btn-exlg .btn-primary .brand-font, .apply-now-btn"),
            o = document.querySelector("#mya-harmonised-button-panel [data-testid='harmonised-apply-button'");
        return n.hasAttribute("onclick") && "False" !== t || o && o.querySelector("[aria-labelledby^='ExternalLinkIcon'") ? "THIRDPARTY" : "APPLY"
    }

    function l(e) {
        var t = document.getElementsByClassName(e);
        return void 0 === t || 0 === t.length || void 0 === document.getElementsByClassName(e)[0].textContent ? "" : document.getElementsByClassName(e)[0].textContent.trim()
    }
    var c = i();
    try {
        var u = 415,
            b = window.innerWidth <= u,
            m = document.createElement("script");
        m.type = "text/javascript", m.src = "/mya/cse/widget.js", m.onload = function() {
            var e = {
                blueprint: "13",
                tenant: c.tenant,
                data: r(),
                start: b ? "minimized" : "expanded",
                style: b ? s("bottom") : {},
                theme: c.theme,
                newConversation: !0,
                themeOverwrite: {
                    header: {
                        text: "Let's get another application started"
                    },
                    links: [{
                        url: "/about/terms-and-conditions",
                        text: "Terms"
                    }, {
                        url: "/about/privacy-policy",
                        text: "Privacy"
                    }]
                },
                tooltip: "I can help you apply to this job, or find a better match."
            };
            mya("boot", e)
        }, document.body.appendChild(m)
    } catch (p) {}
};
var TotalJobsGroup = TotalJobsGroup || {};
TotalJobsGroup.MyaEventsSubscription = function(e) {
    function t(e, t, o, a) {
        a.map(function(e) {
            StStEvents.unsubscribe(e)
        }), n(e, t, o)
    }

    function n(e, t, n) {
        var o = t;
        window.analLib.fireNonStandardOnClickEvent(t, o, n, e)
    }

    function o(t, n) {
        var o = "a.btn.btn-exlg.btn-primary.brand-font.apply-now-btn",
            i = "a.btn.btn-exlg.brand-font.omj-apply-btn",
            r = document.querySelector(t) || document.querySelector(n) || document.querySelector(o) || document.querySelector(i),
            s = document.querySelector("#mya-harmonised-button-panel [data-testid='harmonised-apply-button']") || document.querySelector("#mya-harmonised-button-panel [data-testid='fallback-apply-button']");
        null !== r ? (r.dataset.fromMya = !0, a(r), r.click()) : null != s ? s.click() : window.location.href = "/job/" + e + "/apply?r=1-Mya"
    }

    function a(e) {
        const t = "r=1-One+More+Job",
            n = "r=1-Mya",
            o = "href",
            a = "onclick";
        if (e.hasAttribute(o) === !0) {
            var i = e.getAttribute(o);
            e.setAttribute(o, i.replace(t, n))
        }
        if (e.hasAttribute(a) === !0) {
            var r = e.getAttribute(a);
            e.setAttribute(a, r.replace(t, n))
        }
    }
    var i = {},
        r = function() {
            if (!window.StStEvents) return i;
            var e = "MYA.WIDGET.BOOTED",
                o = "MYA.WIDGET.EXPANDED",
                a = ["MYA.USER.MESSAGE.SUBMITTED", "MYA.CONVERSATION.BUTTON.CLICKED"],
                r = ["1", "23", "30", "77", "223"],
                s = r.map(function(e) {
                    return "eVar" + e
                }).join(",");
            return StStEvents.subscribe(e, function() {
                n(e, "event988", s)
            }), StStEvents.subscribe(o, function() {
                n(o, "event998", s)
            }), a.map(function(e) {
                StStEvents.subscribe(e, function() {
                    t(e, "event999", s, a)
                })
            }), i
        };
    return i.sendApplication = function() {
        o("a[title='Send application']", "a.btn.btn-exlg.btn-primary.brand-font.oca-btn.oca-twin")
    }, i.editApplication = function() {
        o("a[title='Edit application']", "a.btn.btn-exlg.btn-primary.brand-font.apply-now-btn.oca-edit-app.oca-twin")
    }, r()
};
//# sourceMappingURL=recommended-jobs.min.js.map